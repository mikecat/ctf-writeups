<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Steroid Stream (pbctf 2021) Writeup</title>
<script src="../../../../common/common.js"></script>
</head>
<body>
<language-selector data-langlist="日本語,ja,English,en"></language-selector>
<h1>Steroid Stream</h1>
<span class="language-selector-ja">
<p>
プログラム <code>gen.py</code> とその出力 <code>output.txt</code> が与えられた。<br>
<code>gen.py</code> は、以下の処理をするものだった。
</p>
<ol>
<li>数列 <code>key</code> を生成する。</li>
<li><code>key</code> のそれぞれの要素について、その次の要素から最後の要素までからランダムに選んだ<code>key</code>の要素数の3分の1の要素のxorをとることで、数列 <code>fake</code> を生成する。<code>fake</code> の最後3分の1の要素は0とする。</li>
<li><code>key</code> と <code>fake</code> の対応する要素をペアにした列を生成する。どっちをペアの先にするかは乱数で決める。</li>
<li>生成した列をシャッフルする。</li>
<li><code>fake</code>を先にしていたら1、<code>key</code>を先にしていたら0というビット列を用意し、<code>flag</code>のビット列とxorする。</li>
<li>xorした結果とシャッフルした列を出力する。</li>
</ol>
<p>
これは <code>fake</code> の生成方法以外は<a href="../Alkaloid_Stream/" class="language-aware-link">Alkaloid Stream</a>と同じである。
</p><p>
まず、0が入っているペアを参照し、<code>key</code> の最後3分の1の要素を集める。<br>
得られた要素をガウスの消去法の要領で変形し、ある要素の最上位のビットがそれより後の要素で立たないようにしておく。<br>
すると、上位のビットを見ることでxorをするべきかどうかを簡単に判定できるようになる。<br>
これを用いて、これまでに集めた <code>key</code> の要素を指定の数xorした数を含むペアを探すことで、新たな <code>key</code> の要素を探していくことができる。
<p>
これらの性質を利用し、以下のプログラムでflagを求めた。
</p></p>
</span>
<span class="language-selector-en">
<p>
A program <code>gen.py</code> and its output <code>output.txt</code> were given.<br>
What <code>gen.py</code> does is:
</p>
<ol>
<li>Generate a sequence of numbers <code>key</code>.</li>
<li>Generate a sequence of numbers <code>fake</code> by randomly choosing one third of the number of elements in <code>key</code> from the elements from the next position to the end, and calculating exclusive-or of them. The last one third elements of <code>fake</code> are 0.</li>
<li>Generate an array with pairs of corresponding elements of <code>key</code> and <code>fake</code>. Which to put to the first element of the pair is chosen randomly.</li>
<li>Shuffle the array.</li>
<li>Create a sequence of bits by putting 1 when an element of <code>fake</code> is coming first and putting 0 otherwise. Calculate exclusive-or of the sequence and a sequence of bits from <code>flag</code>.</li>
<li>Output the result of exclusive-or and the shuffled array.</li>
</ol>
<p>
This process is the same as one in <a href="../Alkaloid_Stream/" class="language-aware-link">Alkaloid Stream</a> except for how to generate <code>fake</code>.
</p><p>
Firstly, we can correct the last one third elements of <code>key</code> by searching pairs that contains 0.<br>
Then, transform the elements like Gaussian elimination to eliminate a top bit of one element from elements after the element.<br>
This makes it easy to judge if some elements should be included to exclusive-or by checking the top bits.<br>
Then, we can search for a pair that contain a number generated by exclusive-oring the specified number of elements of <code>key</code> seen before to obtain a new element of <code>key</code>.
</p><p>
Using this characteristics, I obtained the flag using this program:
</p>
</span>
<p><a href="solve.py" class="code-link" data-collapse="true">solve.py</a></p>

<div class="flag">pbctf{I_hope_you_enjoyed_this_challenge_now_how_about_playing_Metroid_Dread?}</div>
<hr>
<writeup-by></writeup-by>
<p>
<a href="../../" class="language-aware-link">pbctf 2021</a>
</p>
</body>
</html>
