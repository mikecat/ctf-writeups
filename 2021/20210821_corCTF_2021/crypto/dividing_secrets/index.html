<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>dividing_secrets (corCTF 2021) Writeup</title>
<script src="../../../../common/common.js"></script>
</head>
<body>
<language-selector data-langlist="日本語,ja,English,en"></language-selector>
<h1>dividing_secrets</h1>
<span class="language-selector-ja">
<p>
TCPサーバの接続情報と、サーバのプログラム<code>server.py</code>が与えられた。<br>
<code>server.py</code>は、以下の処理をするものだった。
</p>
<ol>
<li>ランダムな512ビットの素数を生成し、<code>p</code>とする。</li>
<li>1～<code>p</code>の乱数を生成し、<code>g</code>とする。</li>
<li>flagを数値化し、<code>x</code>とする。</li>
<li><code>g</code>、<code>p</code>、「<code>g</code>を<code>x</code>乗して<code>p</code>で割った余り」を出力する。</li>
<li>64回、以下を繰り返す。
<ol>
<li>整数<code>div</code>の入力を受け付ける。</li>
<li><code>g</code>を「<code>x</code>を<code>div</code>で割って整数に切り捨てたもの」乗して<code>p</code>で割った余りを出力する。</li>
</ol>
</li>
</ol>
<p>
「<code>g</code>の<code>x</code>÷<code>div</code>乗」を<code>div</code>乗すると、
<code>g</code>の<code>x</code>乗に比べて<code>x</code>÷<code>div</code>の余りの数だけ<code>g</code>を掛ける回数が少ない数になるはずである。<br>
したがって、この数に<code>g</code>を何回掛けると<code>g</code>の<code>x</code>乗になるかを探索することで、
<code>x</code>÷<code>div</code>の余りを求めることができる。<br>
この余りの情報を集めることで、中国剰余定理により<code>x</code>を求めることができそうである。
</p><p>
これを実行するため、指定した数以上の素数を64個出力するプログラム<code>prime_gen.pl</code>と、
サーバの出力からflagを求めるプログラム<code>solve.py</code>を用意した。
</p>
</span>
<span class="language-selector-en">
<p>
Information to connect to a TCP server and a serve program <code>server.py</code> were given.<br>
What <code>server.py</code> does is:
</p>
<ol>
<li>Generate a random 512-bir prime number and store it to <code>p</code>.</li>
<li>Generate a random number between 1 and <code>p</code>, and store it to <code>g</code>.</li>
<li>Convert the flag to a number and store it to <code>x</code>.</li>
<li>Output <code>g</code>, <code>p</code>, and "<code>g</code> to the <code>x</code>-th power modulo <code>p</code>".</li>
<li>Repeat this 64 times:
<ol>
<li>Read an integer <code>div</code>.</li>
<li>Output <code>g</code> to the "<code>x</code> divided by <code>div</code> and truncated to an integer"-th power modulo <code>p</code>.</li>
</ol>
</li>
</ol>
<p>
"<code>g</code> to the (<code>x</code> divided by <code>div</code>)-th power" to the <code>div</code>-th power will be a value
generated by multiplying <code>g</code>(<code>x</code> modulo <code>div</code>) times lesser than <code>g</code> to the <code>x</code>-th power.<br>
Therefore, we can obtain the <code>x</code> modulo <code>div</code> by searching for the number of <code>g</code> to multiply
to make the value <code>g</code> to the <code>x</code>-th power.<br>
Correcting the modulo information, <code>x</code> should be able to be calculated via the Chinese remainder theorem.
</p><p>
To realize this, I created a program <code>prime_gen.pl</code> to output 64 prime number that are not less than the specified value
and <code>solve.py</code> to obtain the flag from the output of the server.
</p>
</span>
<p><a href="prime_gen.pl" class="code-link" data-collapse="true">prime_gen.pl</a></p>
<p><a href="solve.py" class="code-link" data-collapse="true">solve.py</a></p>

<span class="language-selector-ja">
<p>
以下の手順によりflagが得られた。100以上という設定では上手くflagが得られなかったので、10000以上に設定した。
</p>
<ol>
<li><code>prime_gen.pl</code>を用い、10000以上の素数を生成する。</li>
<li><common-tool data-lang="ja">Tera Term</common-tool>でサーバに接続し、ローカルエコーオフの状態で生成した素数のデータを送信する。</li>
<li>サーバの出力データをコピーし、<code>solve.py</code>に入力する。このときコマンドライン引数で10000を指定する。</li>
</ol>
</span>
<span class="language-selector-en">
<p>
I obtained the flag by the following process. Using prime numbers from 100 didn't work well, so I used prime numbers from 10000.
</p>
<ol>
<li>Generate prime numbers from 10000 via <code>prime_gen.pl</code>.</li>
<li>Connect to the server via <common-tool data-lang="en">Tera Term</common-tool>, set Local echo to OFF, and send the prime numbers.</li>
<li>Copy the output from the server and use it as an input for <code>solve.py</code>. Specify "10000" as the command-line argument to do this.</li>
</ol>
</span>

<div class="flag">corctf{qu4drat1c_r3s1due_0r_n0t_1s_7h3_qu3st1on8852042051e57492}</div>
<hr>
<writeup-by></writeup-by>
<p>
<a href="../../" class="language-aware-link">corCTF 2021</a>
</p>
</body>
</html>
