<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Not So Complicated (DEADFACE CTF) Writeup</title>
<script src="../../../../common/common.js"></script>
</head>
<body>
<language-selector data-langlist="日本語,ja,English,en"></language-selector>
<h1>Not So Complicated</h1>
<span class="language-selector-ja">
<p>
<a href="../Window_Pains/" class="language-aware-link">Window Pains</a> で使ったファイルについて、Jimmie のパスワードを要求された。
</p><p>
一般的に、Windowsのパスワード解析においては <code>SYSTEM</code> と <code>SAM</code> からパスワードのハッシュを抜き出して解析を行うのが定石である。
</p><p>
<common-tool data-lang="ja">Volatility 3</common-tool> を用い、<code>windows.registry.hivelist.HiveList</code> を実行すると、出力の最初の部分は以下のようになった。
</p>
</span>
<span class="language-selector-en">
<p>
Regarding the file used in <a href="../Window_Pains/" class="language-aware-link">Window Pains</a>, Jimmie's password was asked.
</p><p>
Generally speaking, the normal way to crack Windows password is extracting password hashes from <code>SYSTEM</code> and <code>SAM</code> and cracking the hashes.
</p><p>
I executed <code>windows.registry.hivelist.HiveList</code> on <common-tool data-lang="en">Volatility 3</common-tool>. The first part of the output was:
</p>
</span>
<code-block data-extension="txt">
Volatility 3 Framework 1.0.0

Offset	FileFullPath	File output

0xab09bee71000		Disabled
0xab09bee55000	\REGISTRY\MACHINE\SYSTEM	Disabled
0xab09bef33000	\REGISTRY\MACHINE\HARDWARE	Disabled
0xab09c2599000	\Device\HarddiskVolume1\Boot\BCD	Disabled
0xab09bf81f000	\SystemRoot\System32\Config\SOFTWARE	Disabled
0xab09bfb88000	\SystemRoot\System32\Config\DEFAULT	Disabled
0xab09c270f000	\SystemRoot\System32\Config\SECURITY	Disabled
0xab09c27d2000	\SystemRoot\System32\Config\SAM	Disabled
</code-block>

<span class="language-selector-ja">
<p>
これに基づき、<code>windows.registry.hivelist.HiveList --dump --filter \REGISTRY\MACHINE\SYSTEM</code> および <code>windows.registry.hivelist.HiveList --dump --filter \SystemRoot\System32\Config\SAM</code> を用いて <code>SYSTEM</code> や <code>SAM</code> の情報を抜き出そうとした。<br>
その結果、<code>SYSTEM</code> の情報は抜き出せたようだったが、 <code>SAM</code> の情報は抜き出せなかった。
</p><p>
ここで、<code>vol.py -h</code> の出力を観察すると、プラグイン <code>volatility3.plugins.windows.hashdump</code> が読み込めなかった、というような出力がされていた。<br>
さらに、<code>setup.py</code> を読むと、<code>pycryptodome</code> を参照しているようだった。<br>
(<code>README.md</code> には、Optional Dependencies として <code>yara-python</code> と <code>capstone</code> しか載っていなかった)
</p><p>
ローカル環境ではなぜか <code>pycryptodome</code> をインストールしても <code>volatility3.plugins.windows.hashdump</code> は読み込めないままだったので、
<common-tool data-lang="ja">AWS</common-tool> 上にEC2インスタンスを用意し、そこでVolatilityを実行することにした。<br>
インスタンスタイプは <code>t2.micro</code>、AMIは Ubuntu Server 20.04 LTS (HVM), SSD Volume Type (<code>ami-03d5c68bab01f3496</code>) を使用した。<br>
以下のコマンドを実行することで、ダウンロードしたVolatility 3 1.0.1 およびイメージファイルを解凍し、実行できるようになった。
</p>
</span>
<span class="language-selector-en">
<p>
Based on this, I tried to extract information of <code>SYSTEM</code> and <code>SAM</code> using commands<br>
<code>windows.registry.hivelist.HiveList --dump --filter \REGISTRY\MACHINE\SYSTEM</code> and <code>windows.registry.hivelist.HiveList --dump --filter \SystemRoot\System32\Config\SAM</code>.<br>
As a result, I looked succeeded to extract <code>SYSTEM</code>, but it failed to extract <code>SAM</code>.
</p><p>
Looking at the output of <code>vol.py -h</code>, there were some messages saying that a plugin <code>volatility3.plugins.windows.hashdump</code> coundn't be loaded.<br>
Moreover, reading <code>setup.py</code>, I found it requiring <code>pycryptodome</code>.<br>
(Only <code>yara-python</code> and <code>capstone</code> were listed as Optional Dependencies in <code>README.md</code>)
</p><p>
Installing <code>pycryptodome</code> in my local environment didn't activate <code>volatility3.plugins.windows.hashdump</code>,
so I decided to create an EC2 instance on <common-tool data-lang="en">AWS</common-tool> and execute Volatility there.<br>
I used <code>t2.micro</code> instance type and AMI "Ubuntu Server 20.04 LTS (HVM), SSD Volume Type" (<code>ami-03d5c68bab01f3496</code>).<br>
I executed these commands to enable to unzip downloaded Volatility 3 1.0.1 and the memory image file, and to execute Volatility:
</p>
</span>
<code-block data-extension="txt">
sudo apt-get update
sudo apt-get -y install python unzip
</code-block>

<p class="language-selector-ja">
さらに以下のコマンドを実行することで、<code>pycryptodome</code> をインストールし、<code>windows.hashdump.Hashdump</code> を使える状態にすることができた。
</p>
<p class="language-selector-en">
Then, I executed these commands to install <code>pycryptodome</code>. This enabled it to use <code>windows.hashdump.Hashdump</code>.
</p>
<code-block data-extension="txt">
sudo apt-get -y install python3-pip
pip3 install pycryptodome
</code-block>

<span class="language-selector-ja">
<p>
その後 <code>windows.hashdump.Hashdump</code> を実行すると、ユーザ名とハッシュの対応表が得られた。
</p><p>
得られたハッシュのうち <code>Jimmie</code> に対応するものを<common-tool data-lang="ja">CrackStation</common-tool>で解析すると、
パスワードを得ることに成功した。<br>
このパスワードをもとに、flagが得られた。
</p>
</span>
<span class="language-selector-en">
<p>
After that, I ran <code>windows.hashdump.Hashdump</code>, obtaining a table of usernames and corresponding hashes.
</p><p>
I tried to crack the hashes corresponding to <code>Jimmie</code> using <common-tool data-lang="en">CrackStation</common-tool>.<br>
It succeeded to recover the password and I obtained the flag based on the password.
</p>
</span>

<div class="flag">flag{qwertyuiop}</div>
<hr>
<writeup-by></writeup-by>
<p>
<a href="../../" class="language-aware-link">DEADFACE CTF</a>
</p>
</body>
</html>
