<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Vulpixelize (HITCON CTF 2021) Writeup</title>
<script src="../../../../common/common.js"></script>
</head>
<body>
<language-selector data-langlist="日本語,ja,English,en"></language-selector>
<h1>Vulpixelize</h1>
<p class="language-selector-ja" lang="ja">
WebページのURLが与えられた。<br>
このページには、「Download Dockerfile」というリンクと、「Launch」ボタンがあった。<br>
「Download Dockerfile」リンクからは、以下のファイルを含むアーカイブファイルがダウンロードできた。
</p>
<p class="language-selector-en" lang="en">
An URL of a web page was given.<br>
The page had a link saying "Download Dockerfile", and a button saying "Launch".<br>
An archive file that contains these files was available from the "Download Dockerfile" link.
</p>
<code-block data-extension="txt">
vulpixelize
|-- Dockerfile
|-- app
|   |-- app.py
|   |-- static
|   |   |-- bg.jpg
|   |   |-- bootstrap.min.css
|   |   `-- images
|   `-- templates
|       `-- index.html
`-- files
    |-- entrypoint.sh
    |-- read_secret
    `-- secret
</code-block>

<span class="language-selector-ja" lang="ja">
<p>
「Launch」ボタンを押すと、Webページ「Vulpixelize」へのリンクなどが載ったページが現れた。<br>
「Vulpixelize」は、URLを送信すると画像を生成するページのようだった。
</p><p>
アーカイブ中の <code>app/app.py</code> より、この画像は送信したURLのページのスクリーンショットを1920×1080のウィンドウで撮り、64×64に縮小し、また1920×1080に拡大したものであることが読み取れた。<br>
更に、サーバ内部からURLのパス <code>/flag</code> にアクセスすると、<code>FLAG</code> を出力するらしいこともわかった。
</p><p>
実験の結果、<code>FLAG</code> を含むページを<code>iframe</code>で取り込み、それをCSSで拡大して位置をうまく調整すれば、<code>FLAG</code>の画像が得られそうであることがわかった。<br>
拡大は <code>transform: scale</code> で、位置の調整は <code>transform: translate</code> でできた。
</p><p>
試行錯誤により拡大率と位置を調整した結果、以下のPHPファイルを<common-tool data-lang="ja">cloudflared</common-tool>経由でインターネットから参照できるようにし、
「Vulpixelize」から参照させることで、<code>FLAG</code>の一部を画像として得られることがわかった。
</p>
</span>
<span class="language-selector-en" lang="en">
<p>
Pressing the "Launch" button, a page that has a link to a web page "Vulpixelize" and some other information appeared.<br>
This page "Vulpixelize" looked like a page that generates an image when I send an URL.
</p><p>
Reading <code>app/app.py</code> in the archive, I found that the image is generated by taking a screenshot of the page corresponding to the URL sent with a 1920x1080 window, shrinking the image to 64x64, and then enlarging the image to 1920x1080.<br>
I also found that <code>FLAG</code> will be shown when accessing an URL with path <code>/flag</code> from the server itself.
</p><p>
After some experiments, I found that it should be able to obtain the image of <code>FLAG</code> by putting the page with <code>FLAG</code> in <code>iframe</code>, and using CSS to enlarge that and adjust its position.<br>
Enlarging can be done via <code>transform: scale</code>. Adjusting the position can be done via <code>transform: translate</code>.
</p><p>
After some trial-and-error to adjust the scale and position, I found that we can obtain a part of the <code>FLAG</code> by making this PHP file available from the internet via <common-tool data-lang="en">cloudflared</common-tool> and having "Vulpixelize" fetch the page.
</p>
</span>
<p><a href="display.php.txt" class="code-link" data-collapse="true" data-extension="php">display.php</a></p>

<p class="language-selector-ja" lang="ja">
さらに、横方向の位置を変化させながら「Vulpixelize」から画像を取得し、縮小して合体させる以下のプログラムを作成した。<br>
第1引数は <code>http://198.51.100.51:12345/</code> のような「Vulpixelize」のURLを、<br>
第2引数は <code>http://xxxxxxxxxxx.trycloudflare.com/display.php</code> のようなPHPファイルのURLを指定する。
</p>
<p class="language-selector-en" lang="en">
Then, I created this program to retrieve images from "Vulpixelize" with sweeping the horizontal position, to shrink them and to concatenate them.<br>
The 1st argument should be the URL of "Vulpixelize" like <code>http://198.51.100.51:12345/</code>,<br>
and the 2nd argument should be an URL of the PHP file like <code>http://xxxxxxxxxxx.trycloudflare.com/display.php</code>.
</p>
<p><a href="fetcher.py" class="code-link" data-collapse="true">fetcher.py</a></p>

<p class="language-selector-ja" lang="ja">
このプログラムを実行すると、以下の画像が得られた。
</p>
<p class="language-selector-en" lang="en">
I obtained this image by executing this program.
</p>
<p><a href="fetched.png"><img src="fetched-thumb.jpg" alt="result image"></a></p>

<p class="language-selector-ja" lang="ja">
この画像からflagを読み取った。
</p>
<p class="language-selector-en" lang="en">
I read the flag from this image.
</p>

<div class="flag">hitcon{1-1-4-1-6-1-e-9-f-9-4-c-7-3-e-4-9-7-a-7-5-d-4-6-6-c-6-3-3-7-f-4}</div>
<hr>
<writeup-by></writeup-by>
<p>
<a href="../../" class="language-aware-link">HITCON CTF 2021</a>
</p>
</body>
</html>
